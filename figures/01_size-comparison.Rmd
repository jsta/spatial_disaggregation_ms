---
title: "Figures"
output:
  pdf_document:
    fig_caption: yes
---

```{r setup_01, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.path = "../figures/", fig.width = 5, fig.height = 6)
```

```{r read_chunks_01, cache=FALSE, echo=FALSE}
knitr::read_chunk("../scripts/99_utils.R")
```

```{r source_utils, message=FALSE, results='hide', echo=FALSE, warning=FALSE}

```

```{r 01_size-comparison, echo=FALSE, warning=FALSE, fig.width = 5.5, fig.height = 2.5, message=FALSE}
# ---- size_comparison ----
# setwd("scripts"); source("../scripts/99_utils.R")
gpkg_path <- "../data/gis.gpkg"
states   <- st_read(gpkg_path, layer = "states", stringsAsFactors = FALSE)
hu4s     <- st_read(gpkg_path, layer = "hu4s", stringsAsFactors = FALSE)
hu8s     <- st_read(gpkg_path, layer = "hu8s", stringsAsFactors = FALSE)
counties <- st_read(gpkg_path, layer = "counties", stringsAsFactors = FALSE)
iws      <- st_read(gpkg_path, layer = "iws", stringsAsFactors = FALSE)

q          <- seq(0, 1, length.out = 20)
res        <- lapply(list(hu4s, counties, iws, hu8s),
              function(x) as.numeric(quantile(st_area(x), probs = q)))
names(res) <- c("hu4", "county", "iws", "hu8s")
res        <- dplyr::bind_rows(res) %>%
  mutate(q = q) %>%
  tidyr::gather(key = "scale", value = "area", -q) %>%
  mutate(scale = factor(scale, levels = c("iws", "county", "hu8s", "hu4")))

theme_opts <- theme_minimal() +
  theme(axis.title = element_text(size = 12),
        axis.text.x = element_text(size = 10, angle = 90),
        axis.text.y = element_text(size = 10),
        legend.text = element_text(size = 10), 
        axis.line = element_line())

color_key <- setNames(viridis::viridis(4), 
                      c("iws", "county", "hu8s", "hu4"))

g_full <- ggplot() +
  geom_line(data = res, aes(x = area, y = rev(q), color = scale), size = 1.5) +
  ylab("Density") + xlab("Area (m2)") +
  scale_x_continuous(labels = c("2^10", "10^10", "11^10", "12^10"),
                     breaks = c(10^2, 10^10, 11^10, 12^10)) +
  scale_color_manual(values = color_key) +
  theme_opts +
  labs(color = "")

g_zoom <- ggplot() +
  geom_line(data = dplyr::filter(res, scale %in% c("iws", "county", "hu8s")), 
            aes(x = area, y = rev(q), color = scale), size = 1.5) +
  ylab("Density") + xlab("Area (m2)") +
  scale_x_continuous(labels = c("2^10", "10^10"),
                     breaks = c(2^10, 10^10)) + 
  scale_color_manual(values = color_key) +
  theme_opts +
  labs(color = "")

legend <- get_legend(g_full)

plot_grid(
  g_zoom + theme(legend.position = "none"),
  g_full + theme(legend.position = "none", 
                 axis.text.y = element_blank()) +
    ylab(""), 
  legend,
  nrow = 1)
```
